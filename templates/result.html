<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .container { max-width: 1100px; margin: 30px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .back { text-decoration: none; background: #6c757d; color: white; padding: 10px 20px; border-radius: 5px; }
    .back:hover { background: #545b62; }
    .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
    .stat { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; }
    .stat .val { font-size: 1.5em; font-weight: bold; color: #007bff; }
    .error { background: #f8d7da; color: #721c24; padding: 20px; border-radius: 8px; margin: 20px 0; }
    .btn { background: #007bff; color: white; padding: 12px 20px; text-decoration: none; border-radius: 5px; }
    .btn:hover { background: #0056b3; }
    details { margin-top: 15px; }
    .timeline { margin-top: 14px; }
    .row { padding:5px 0; border-bottom:1px solid #eee; display:flex; gap:12px; justify-content:space-between; }
    .tag { font-size: 12px; color:#6c757d; }
    video { width:100%; max-height: 520px; background: #000; border-radius:8px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏</h1>
      <a href="/" class="back">‚Üê –ù–∞–∑–∞–¥</a>
    </header>

    {% if stats.error %}
      <div class="error">‚ùå –û—à–∏–±–∫–∞: {{ stats.error }}</div>
    {% else %}
      <h2>‚úÖ –£—Å–ø–µ—à–Ω–æ!</h2>

      <div class="stat-grid">
        <div class="stat"><div class="val">{{ stats.video_info.duration|round(2) }}s</div>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏—Å—Ö–æ–¥–Ω–∏–∫–∞</div>
        <div class="stat"><div class="val">{{ stats.scenes_detected }}</div>–ö—É—Å–∫–æ–≤ (–ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞)</div>
        <div class="stat"><div class="val">{{ stats.unique_scenes }}</div>–û—Å—Ç–∞–≤–ª–µ–Ω–æ</div>
        <div class="stat"><div class="val">{{ stats.removed_scenes }}</div>–£–¥–∞–ª–µ–Ω–æ (—Ü–µ–Ω—Ç—Ä—ã —Ä—É–Ω)</div>
      </div>

      {% if stats.compressed_filename %}
        <div style="margin: 20px 0;">
          <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
          <video controls preload="metadata" playsinline>
            <source src="{{ url_for('serve_output', filename=stats.compressed_filename) }}" type="video/mp4">
            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
          </video>

          <!-- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ -->
          <div style="text-align:center; margin-top:12px;">
            <a href="{{ url_for('download_file', filename=stats.compressed_filename) }}" class="btn">üíæ –°–∫–∞—á–∞—Ç—å —Å–∂–∞—Ç–æ–µ –≤–∏–¥–µ–æ</a>
            {% if stats.compression_stats %}
              <p class="tag" style="margin-top:8px;">
                –†–∞–∑–º–µ—Ä: {{ stats.compression_stats.compressed_size_mb }} MB |
                –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {{ stats.compression_stats.compressed_duration }}s |
                –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏: ‚àí{{ stats.compression_stats.time_saved_seconds }}s
              </p>
            {% endif %}
          </div>
        </div>
      {% else %}
        <div class="error">
          ‚ö†Ô∏è –°–∂–∞—Ç—ã–π —Ñ–∞–π–ª –Ω–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ FFmpeg (—Å–º. –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞).
        </div>
      {% endif %}

      <div>
        <h3>üìå –î–µ—Ç–∞–ª–∏ —Å—Ü–µ–Ω</h3>
        <p class="tag">–ù–∞ —Ç–∞–π–º–ª–∞–π–Ω–µ –Ω–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω—ã –æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∏ –≤—ã—Ä–µ–∑–∞–Ω–Ω—ã–µ ¬´—Ü–µ–Ω—Ç—Ä—ã –ø–æ–≤—Ç–æ—Ä–æ–≤¬ª.</p>

        {% if stats.unique_scenes_details %}
          <details open>
            <summary>–û—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã ({{ stats.unique_scenes }})</summary>
            <div class="timeline">
              {% for s in stats.unique_scenes_details %}
                <div class="row">
                  <div>{{ s.start|round(2) }}s ‚Üí {{ s.end|round(2) }}s</div>
                  <div class="tag">({{ s.duration|round(2) }}s)</div>
                </div>
              {% endfor %}
            </div>
          </details>
        {% endif %}

        {% if stats.removed_scenes_details %}
          <details style="margin-top:10px;">
            <summary>–£–¥–∞–ª—ë–Ω–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã ¬´–ø–ª–æ—Å–∫–∏—Ö¬ª —Ä—É–Ω ({{ stats.removed_scenes }})</summary>
            <div class="timeline">
              {% for r in stats.removed_scenes_details %}
                <div class="row" style="color:#b02a37;">
                  <div>‚àí {{ r.start|round(2) }}s ‚Üí {{ r.end|round(2) }}s</div>
                  <div class="tag">({{ r.duration|round(2) }}s)</div>
                </div>
              {% endfor %}
            </div>
          </details>
        {% endif %}
      </div>
    {% endif %}
  </div>
</body>
</html>
